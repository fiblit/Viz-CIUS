<!DOCTYPE html>
<!-- saved from url=(0086)https://ay16.moodle.umn.edu/pluginfile.php/1953944/mod_resource/content/1/HelloD3.html -->
<html lang="en" class="gr__ay16_moodle_umn_edu">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>FBI: UCR: CIUS</title>	
        <!-- https://github.com/d3/d3 -->
        <script src="https://d3js.org/d3.v3.js"></script>
            <!-- for d3.geo.path to work we need v3, however I read that
            we can use v4 if we change it to geoPath. Didn't bother yet -->'
        <!-- https://github.com/d3/d3-geo -->
        <script src="https://d3js.org/d3-array.v1.min.js"></script>
        <script src="https://d3js.org/d3-geo.v1.min.js"></script>
        <script>
            var projection = d3.geoAlbers(),
                path = d3.geoPath(projection);
        </script>
        <style>
            svg {
                background: #eee;
                width: 1200px;
                height: 800px;
            }

            .overlay {
                fill: none;
                pointer-events: all;
            }

            #counties path {
                stroke: #000;
                stroke-width: .25px;
            }


            #states path {
                fill: none;
                stroke: #fff;
                stroke-width: .25px;
            }

            .Blues .q0-9{fill:rgb(247,251,255)}
            .Blues .q1-9{fill:rgb(222,235,247)}
            .Blues .q2-9{fill:rgb(198,219,239)}
            .Blues .q3-9{fill:rgb(158,202,225)}
            .Blues .q4-9{fill:rgb(107,174,214)}
            .Blues .q5-9{fill:rgb(66,146,198)}
            .Blues .q6-9{fill:rgb(33,113,181)}
            .Blues .q7-9{fill:rgb(8,81,156)}
            .Blues .q8-9{fill:rgb(255,48,107)}
        </style>
    </head>
    <body data-gr-c-s-loaded="true">
        <script type="text/javascript">

        //source
        // https://strongriley.github.io/d3/ex/choropleth.html
        var data; // loaded asynchronously later.

        var margin = {top: -5, right: -5, bottom: -5, left: -5},
            width = 1200 - margin.left - margin.right,
            height = 800 - margin.top - margin.bottom;

        var path = d3.geo
            .path();

        var svg = d3
            .select("body")
            .append("svg:svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .call(d3.behavior.zoom().scaleExtent([1, 10]).on("zoom", zoom))
            .append("g");

        svg.append("rect")
            .attr("class", "overlay")
            .attr("width", width)
            .attr("height", height);

        var counties = svg
            .append("svg:g")
            .attr("id", "counties")
            .attr("class", "Blues");

        var states = svg
            .append("svg:g")
            .attr("id", "states");

        var FIPS;
        d3.csv("./data/FIPS_national.txt", function(csv) {
            FIPS = csv;
            console.log(FIPS[0]);
        });

        d3.json("./data/us-counties.json", function(json) {
            counties
                .selectAll("path")
                    .data(json.features)
                    .enter()
                        .append("svg:path")
                            .attr("class", data ? quantize : null)
                            .attr("d", path);
        });

        d3.json("./data/us-states.json", function(json) {
            states
                .selectAll("path")
                    .data(json.features)
                    .enter()
                        .append("svg:path")
                            .attr("d", path);
        });

        d3.json("./data/unemployment.json", function(json) {
            data = json;
            counties
                .selectAll("path")
                    .attr("class", quantize);
        });


        d3.json("./data/us-counties.json", function(json) {
            counties
                .selectAll("path")
                    .data(json.features)
                    .enter()
                        .append("svg:path")
                            .attr("d", path);
        });

        //this maps counties to the unemployment data
        function quantize(d) {
            //what the hell is that ~~ operator?
            if (data[d.id] > 30) {
                console.log(d.id+" "+ data[d.id]);
                return "q8-9";
            }
            else
                return "q" + Math.min(8, ~~(data[d.id] * 1 / 12)) + "-9";
        }

        function state_county_to_FIPS_id(state,county) {
            function state_to_abbrev(state) {
                state = state.toUpperCase().split(" ");
                var mapping = {
                    "ALABAMA":"AL","ALASKA":"AK","ARIZONA":"AZ","ARKANSAS":"AR","CALIFORNIA":"CA",
                    "COLORADO":"CO","CONNETICUT":"CT","DELEWARE":"DE","FLORIDA":"FL","GEORGIA":"GA",
                    "HAWAII":"HI","IDAHO":"ID","ILLINOIS":"IL","INDIANA":"IN","IOWA":"IA",
                    "KANSAS":"KS","KENTUCKY":"KY","LOUSIANA":"LA","MAINE":"ME","MARYLAND":"MD",
                    "MASSACHUSETTS":"MA","MICHIGAN":"MI","MINNESOTA":"MN","MISSISIPI":"MI","MISSOURI":"MO",
                    "MONTANA":"MT","NEBRASKA":"NE","NEVADA":"NV",/*NEW HAMPSHIRE,NEW JERSEY,*/
                    /*NEW MEXICO,NEW YORK,NORTH CAROLINA,NORTH DAKOTA*/"OHIO":"OH",
                    "OKLAHOMA":"OK","OREGON":"OR","PENNSYLVANIA":"PA","RHODE":/*ISLAND*/"RI",/*SOUTH CAROLINA,*/
                    /*SOUTH DAKOTA,*/"TENNESSEE":"TN","TEXAS":"TX","UTAH":"UT","VERMONT":"VT",
                    "VIRGINIA":"VA","WASHINGTON":"WA","WEST":/*VIRGINIA*/"WV","WISCONSIN":"WI","WYOMING":"WY"
                };
                if (state[0] == "NORTH") {
                    var mappingSub = {"CAROLINA":"NC", "DAKOTA":"ND"};
                    return mappingSub[state[1]];
                }
                else if (state[0] == "SOUTH") {
                    var mappingSub = {"CAROLINA":"SC", "DAKOTA":"SD"};
                    return mappingSub[state[1]];
                }
                else if (state[0] == "NEW") {
                    var mappingSub = {"YORK":"NY", "HAMPSHIRE":"NH","MEXICO":"NM","JERSEY":"NJ"};
                    return mappingSub[state[1]];
                }
                else {
                    return mapping[state[0]];
                }
            }

            var abbrev = state_to_abbrev(state);
            FIPS.forEach(function(d) {
                if(d.state == abbrev && d.name.split(" ")[0].toUpperCase() == county.toUpperCase()) {
                    return d.id + d.subid;
                }
            });
        }

        function zoom() {
            svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }

        </script>
    </body>
</html>