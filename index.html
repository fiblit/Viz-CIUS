<!DOCTYPE html>
<!-- saved from url=(0086)https://ay16.moodle.umn.edu/pluginfile.php/1953944/mod_resource/content/1/HelloD3.html -->
<html lang="en" class="gr__ay16_moodle_umn_edu">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>FBI: UCR: CIUS</title>	
        <!-- https://github.com/d3/d3 -->
        <script src="https://d3js.org/d3.v3.js"></script>
            <!-- for d3.geo.path to work we need v3, however I read that
            we can use v4 if we change it to geoPath. Didn't bother yet -->'
        <!-- https://github.com/d3/d3-geo -->
        <script src="https://d3js.org/d3-array.v1.min.js"></script>
        <script src="https://d3js.org/d3-geo.v1.min.js"></script>
        <script>
            var projection = d3.geoAlbers(),
                path = d3.geoPath(projection);
        </script>
        <style>
            svg {
                background: #eee;
                width: 1000px;
                height: 600px;
            }

            .overlay {
                fill: none;
                pointer-events: all;
            }

            #counties path {
                stroke: #000;
                stroke-width: .25px;
            }


            #states path {
                fill: none;
                stroke: #fff;
                stroke-width: .25px;
            }

            .Blues .q0-9{fill:rgb(247,251,255)}
            .Blues .q1-9{fill:rgb(222,235,247)}
            .Blues .q2-9{fill:rgb(198,219,239)}
            .Blues .q3-9{fill:rgb(158,202,225)}
            .Blues .q4-9{fill:rgb(107,174,214)}
            .Blues .q5-9{fill:rgb(66,146,198)}
            .Blues .q6-9{fill:rgb(33,113,181)}
            .Blues .q7-9{fill:rgb(8,81,156)}
            .Blues .q8-9{fill:rgb(255,48,107)}
        </style>
    </head>
    <body data-gr-c-s-loaded="true">
        <script type="text/javascript">

        //source
        // https://strongriley.github.io/d3/ex/choropleth.html
        var data = ["./data/Tb_10_Offenses_by_Counties_2006.csv",
            "./data/Tb_10_Offenses_by_Counties_2007.csv",
            "./data/Tb_10_Offenses_by_Counties_2008.csv",
            "./data/Tb_10_Offenses_by_Counties_2009.csv",
            "./data/Tb_10_Offenses_by_Counties_2010.csv",
            "./data/Tb_10_Offenses_by_Counties_2011.csv",
            "./data/Tb_10_Offenses_by_Counties_2012.csv",
            "./data/Tb_10_Offenses_by_Counties_2013.csv",
            "./data/Tb_10_Offenses_by_Counties_2014.csv",
            "./data/Tb_10_Offenses_by_Counties_2015.csv"]; // loaded asynchronously later.
        var set = 0;
        var datasets = [{},{},{},{},{},{},{},{},{},{}];

        var margin = {top: -5, right: -5, bottom: -5, left: -5},
            width = 1000 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        var path = d3.geo
            .path();

        var svg = d3
            .select("body")
            .append("svg:svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .call(d3.behavior.zoom().scaleExtent([1, 10]).on("zoom", zoom))
            .append("g");

        var map = d3.select('svg g');
        map.on('click',function() {
            console.log('clicked');
            nextMap();
        });

        svg.append("rect")
            .attr("class", "overlay")
            .attr("width", width)
            .attr("height", height);

        var counties = svg
            .append("svg:g")
            .attr("id", "counties")
            .attr("class", "Blues");

        var states = svg
            .append("svg:g")
            .attr("id", "states");

        var FIPS;
        d3.csv("./data/FIPS_national.txt", function(csv) {
            FIPS = csv;
        });

        d3.json("./data/us-counties.json", function(json) {
            counties
                .selectAll("path")
                    .data(json.features)
                    .enter()
                        .append("svg:path")
                            /* apparently this is asynchronous */
                            .attr("class", datasets[set] ? labelmap : null)
                            .attr("d", path);
        });

        d3.json("./data/us-states.json", function(json) {
            states
                .selectAll("path")
                    .data(json.features)
                    .enter()
                        .append("svg:path")
                            .attr("d", path);
        });

        for (var i = 0; i < data.length; i++){
            var iter = function (i){
                d3.csv(data[i], function(csv) {
                    csv.forEach(function(d) {   // doing this asynch?
                        if (datasets[i][d.idsubid] == null){
                            datasets[i][d.idsubid] = d;
                        }
                        else{ //for adding police departments
                            datasets[i][d.idsubid]["Violent crime"] += d["Violent crime"]; 
                            datasets[i][d.idsubid]["Murder and nonnegligent manslaughter"] += d["Murder and nonnegligent manslaughter"];
                            datasets[i][d.idsubid]["Rape(revised definition)1"] += d["Rape(revised definition)1"];
                            datasets[i][d.idsubid]["Rape(legacy definition)2"] += d["Rape(legacy definition)2"];
                            datasets[i][d.idsubid]["Robbery"] += d["Robbery"];
                            datasets[i][d.idsubid]["Aggravated assault"] += d["Aggravated assault"];
                            datasets[i][d.idsubid]["Property crime"] += d["Property crime"];
                            datasets[i][d.idsubid]["Burglary"] += d["Burglary"];
                            datasets[i][d.idsubid]["Larceny-theft"] += d["Larceny-theft"];
                            datasets[i][d.idsubid]["Motor vehicle theft"] += d["Motor vehicle theft"];

                        }
                    });
                    console.log(i);
                    console.log(datasets[i]);
                });
            }(i);
        }
        //i=0;
        // counties.selectAll("path")
        //         .attr("class",datasets[set] ? labelmap : null)
        //         .attr("d", path)
        //var mytimer = setInterval(updateMap,10000);

        function nextMap() {
            counties.selectAll("path")
                .attr("class",datasets[set] ? labelmap : null)
                .attr("d", path)
            set = (set+1) % 3;//datasets.length;
        }
        function prevMap() {
            counties.selectAll("path")
                .attr("class",datasets[set] ? labelmap : null)
                .attr("d", path)
            set = (set+datasets.length-1) % datasets.length;
        }
        function labelmap(d) {
            if (datasets[set][d.id] == null)
                return "q0-9";
                            /*change the Violentcrime if you don't see red*/
            else if (datasets[set][d.id]['Violent crime'] == 0)
                return "q8-9";
            else
                return "q3-9";
        }

        
        function zoom() {
            svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }

        </script>
    </body>
</html>